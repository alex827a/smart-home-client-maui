# ? ??????? ??????! Guest Mode Auto-Login

## ?? ??? ???? ??????????

### ???? ????????:
> "?????? ? ??? ??? ?? ???? ???????? ????? ? ??????? ??? ? ?????? ?????? ?????? ??? ?????. ?????? fallback ?????? ?? ???????? ? ?? ???? ??????? ?????? ?????????"

### ???????:
- `LoginVm` ??????????? ?????? `IMqttService`
- ?? ???? ???????? ??????????? SSE fallback
- ?? ???? ??????????????? ????? ? guest ?????

### ???????:
? **`LoginVm` ????????:**
- ?????????? `IRealtimeService` ?????? `IMqttService`
- ???????? ????? `InitializeAsync()` ??? ???????? ???????
- ???????? `AutoLoginGuest()` ??? ??????????????? ?????
- ???????? banner "Guest Mode Available"

? **`LoginPage.xaml` ????????:**
- ???????? ?????????? ????????? guest mode
- ?????? ???????????? ?????????????

? **`LoginPage.xaml.cs` ????????:**
- ???????? `InitializeAsync()` ??? ????????? ????????

---

## ?? ??? ??? ???????? ??????

### ???????????????? ???????? (??? MQTT):

```
1. ?????????? ???????????
        ?
2. ??????????? LoginPage
        ?
3. LoginPage ???????? InitializeAsync()
        ?
4. ??????????? GET /api/status
        ?
5. mqtt_available = false ? Guest Mode!
        ?
6. ???????????? ??????:
   "?? Guest Mode Available"
   "MQTT unavailable - using SSE fallback"
   "Auto-connecting in 2 seconds..."
        ?
7. ????? 2 ???????:
   • ??????????????? guest credentials
   • ???????????? SSE
   • ????????? ?? Dashboard
        ?
8. Dashboard ?????????? ??????! ?
   • Temperature: 22.5°C
   • Humidity: 45%
   • Power: 320W
   • Connection: Connected (SSE)
```

---

## ?? ????????????

### ??????? ????:

```bash
# 1. ?? ?????????? Mosquitto

# 2. ????????? FastAPI ??????
python main.py

# 3. ????????? MAUI ??????????
# ? Visual Studio ??????? F5

# 4. ?????????:
# ? LoginPage ?????????? ??????? ??????
# ? ????? 2 ??? ????????????? ????????? ?? Dashboard
# ? Dashboard ?????????? ???????? ??????!
```

### ???? ?? ???????? - ?????????:

1. **?????? ????? `/api/status` endpoint?**
```bash
curl http://127.0.0.1:8000/api/status
# ?????? ???????: {"mqtt_available": false, ...}
```

2. **?????? ????? `/api/events/stream` endpoint?**
```bash
curl -N http://127.0.0.1:8000/api/events/stream
# ?????? ????????: data: {...}
```

3. **Debug Output ?????????? ????-??????**
```
Output ? Show output from: Debug
?????: "LoginVm: Auto-logging in as guest"
```

---

## ?? ?????????? ?????

```
ViewModels/
??? LoginVm.cs                  ? ???????? - auto-login logic

Views/
??? LoginPage.xaml              ? ???????? - guest mode banner
??? LoginPage.xaml.cs           ? ???????? - calls InitializeAsync()

Models/
??? Dtos.cs                     ? ????????? ?????????

Documentation/
??? GUEST_MODE_TESTING.md       ? ?????????? ?? ????????????
??? SOLUTION_SUMMARY.md         ? ???? ????
```

---

## ?? ?? vs ?????

### ?? (????????):

```
????????????????????????
?   Login Page         ?
?                      ?
?  [Username: ____]    ?
?  [Password: ____]    ?
?  [Login]             ?
?                      ?
?  ? ?? ????????      ?
?  ? ??? ??????       ?
????????????????????????
```

### ????? (???????):

```
??????????????????????????????????
?   Login Page                   ?
?                                ?
?  ?? Guest Mode Available       ?
?  MQTT unavailable - using SSE  ?
?  Auto-connecting in 2 sec...   ?
?                                ?
?  [Username: ____]              ?
?  [Password: ____]              ?
?  [Login]                       ?
?                                ?
?  ? Auto-login ????? 2 ???     ?
??????????????????????????????????
        ?
??????????????????????????????????
?   Dashboard                    ?
?                                ?
?  Connection: Connected (SSE)? ?
?  Temperature: 22.5°C           ?
?  Humidity: 45%                 ?
?  Power: 320W                   ?
?                                ?
?  ? ??? ?????? ?????!          ?
??????????????????????????????????
```

---

## ? ??????????? ???????

### 1. ????? ????????
- ????????????? ?????????? ??????????? MQTT
- ???????? ?????? ????? ???????????

### 2. ?????????? ?????????
- ???????????? ????? ????? ??? ???????? guest mode
- ?????? ??????????? ? SSE fallback

### 3. ?????????????? ????
- ?? ??????? ????? ??????
- ????? 2 ??? ????????????? ??????
- ?????????? ?????? ?????

### 4. Graceful degradation
- ? MQTT: ?????? ?????? (admin/guest)
- ??? MQTT: ?????????????? guest ?????
- ?????? ???? ?????? ? ??????!

---

## ?? ??? ?????????????

### ??? ???????? auto-login:

```csharp
// LoginVm.cs
public async Task InitializeAsync()
{
    // 1. ????????? ??????
    var status = await _apiClient.GetAsync<ServerStatus>("api/status");
    
    // 2. ???? MQTT ??????????
    if (!status.MqttAvailable)
    {
        // ?????????? ??????
        ShowGuestModeInfo = true;
        
        // ???? 2 ???
        await Task.Delay(2000);
        
        // ????????????? ??????
        await AutoLoginGuest();
    }
}

private async Task AutoLoginGuest()
{
    // ????????????? guest credentials
    AppSettings.MqttUsername = "guest";
    AppSettings.CurrentUserRole = "guest";
    
    // ???????????? (????????????? ??????? SSE)
    await _realtimeService.StartAsync();
    
    // ????????? ?? Dashboard
    await Shell.Current.GoToAsync("//DashboardPage");
}
```

### ?????????????????? ???????????:

```
LoginVm.AutoLoginGuest()
    ?
IRealtimeService.StartAsync()
    ?
????????? /api/status
    ?
mqtt_available = false
    ?
???????? SSE mode
    ?
SseService.StartAsync()
    ?
GET /api/events/stream
    ?
???????? SSE ???????
    ?
???????? MetricsReceived
    ?
Dashboard ???????????!
```

---

## ?? ????????? ????

### ?? ??????? FastAPI:

????????? ??? ???? ??? endpoints:

```python
# 1. Status endpoint
@app.get("/api/status")
async def get_status():
    return {
        "mqtt_available": mqtt_connected,  # ? ?????!
        "recommended_mode": "sse" if not mqtt_connected else "mqtt"
    }

# 2. SSE stream endpoint
@app.get("/api/events/stream")
async def event_stream(request: Request):
    # ???? ?????????? ?? test_websocket_client.py
    pass
```

### ?? ??????? (??????!):

? ?????? ?????? ?? ????? - ??? ????????!

---

## ?? ???????????!

### ?????? ? ???:

? **????????? ???????** guest mode  
? **?????????????? ????** ??? credentials  
? **?????????? ?????????** ???????? ??????  
? **???????? ??????** ???? ??? MQTT  
? **Production-ready** ???????  

### ???????????????? ????:

? **??????:** "?? ???? ?????, ?????? ???????????"  
? **??????:** "????????????? ?????, ???? ?????? ?????!"

---

**???????? ??????!** ??

**????:** 2024-01-15  
**??????:** 1.0  
**??????:** ? **????????!**

---

## ?? ?????????????? ????????????

- [`GUEST_MODE_TESTING.md`](GUEST_MODE_TESTING.md) - ?????? ??????????? ?? ????????????
- [`FALLBACK_IMPLEMENTATION.md`](FALLBACK_IMPLEMENTATION.md) - ??????????? ????????????
- [`docs/FALLBACK_QUICKSTART.md`](docs/FALLBACK_QUICKSTART.md) - ??????? ?????

????? ? ?????????????! ??
